---
title: "Navigating the S&P 500 with Machine Learning: What Can We Discover?"
subtitle: "Proposal"
author: 
  - name: "Macdonald-Kuthalaraja - Trevor Macdonald, Nandakumar Kuthalaraja "
    affiliations:
      - name: "College of Information Science, University of Arizona"
description: "Machine learning gives us smart tools to find patterns, make predictions, and understand complicated trends in the stock market. By using these techniques with S&P 500 data, we can answer important questions about where the market might go, how risky it is, and how stocks relate to each other. This project explores new methods—from deep learning (which helps predict future returns), to models that sort days by how volatile they are, to clustering methods that group similar stocks together. With these tools, we aim to discover fresh insights about the S&P 500 in 2024."
format:
  html:
    code-tools: true
    code-overflow: wrap
    code-line-numbers: true
    embed-resources: true
editor: visual
code-annotations: hover
execute:
  warning: false
jupyter: python3
---

```{python}
#| label: Set Up
#| message: false

import numpy as np
import pandas as pd
import yfinance as yf
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import mean_squared_error, mean_absolute_error
from keras.models import Sequential
from keras.layers import LSTM, Dense, Dropout
from keras.callbacks import EarlyStopping

```

## Dataset

```{python}
#| label: load-dataset
#| message: false

print("Downloading SPX data...")
data = yf.download('^GSPC', start='2014-01-01', end='2024-12-31')

# Flatten MultiIndex columns if necessary
if isinstance(data.columns, pd.MultiIndex):
    data.columns = ['_'.join(col).strip() for col in data.columns.values]

```

This dataset contains daily historical price data for the S&P 500 index (\^GSPC), downloaded using the yfinance Python package. It spans from January 1, 2014 to December 31, 2024s.

The dataset includes the following key variables: • Open: Opening price of the index each day • High: Highest price during the trading day • Low: Lowest price during the trading day • Close: Closing price of the day

We chose the S&P 500 dataset because it serves as a benchmark for the U.S. stock market, reflecting the performance of 500 leading publicly traded companies. This makes it ideal for exploring machine learning techniques in financial time series analysis, including trend prediction, volatility classification, and return forecasting.

With these techniques in proposal, we aim to uncover specific insights such as improved short- and long-term return forecasts from LSTM models, clearer volatility regime patterns via classification, and meaningful stock groupings through clustering of factor exposures. By quantifying accuracy across forecast horizons, identifying key predictors of risk regimes, and mapping stocks by shared characteristics, we move beyond general findings to actionable understanding of market behavior in 2024.

## Questions

The four questions you want to answer.

Q1. How well can we classify each trading day in 2024 into low, medium, or high volatility regimes based on recent price action and market indicators?

Q2. How can hierarchical clustering organize S&P 500 stocks into a taxonomy based on multi-factor risk or return exposures between 2014-2024?

## Analysis plan (Q1)

This uses Supervised Machine Learning Methods for exploring

1.  Feature Engineering: Calculate recent price action and market indicators (e.g., rolling volatility, intraday range, moving averages, volume, VIX).
2.  Target Creation: Label each trading day as “low”, “medium”, or “high” volatility based on daily realized volatility bins (e.g., using tertiles or quantiles).
3.  Model Training: Use supervised learning models (e.g., decision tree, random forest, XGBoost) to classify the volatility regime from engineered features.
4.  Evaluation: Evaluate classification results with accuracy, confusion matrix, and analyze which features most influence volatility regime assignment.

| Step | Description |
|-------------------|-----------------------------------------------------|
| Prepare Features | Gather recent price action (returns, volatility) and market indicators for each trading day. |
| Create Volatility Classes | Divide days into low, medium, and high volatility using quantiles or thresholds. |
| Train Classifier | Fit a supervised learning model to predict volatility class from the features. |
| Evaluate Model | Assess model accuracy and review which features are most predictive. |

Potential Variables

| Variable        | Description                                         |
|-----------------|-----------------------------------------------------|
| prev_day_return | Return from the previous trading day                |
| rolling_std_5   | 5-day rolling standard deviation (volatility)       |
| rolling_std_21  | 21-day (1-month) rolling standard deviation         |
| ATR_14          | 14-day Average True Range (volatility indicator)    |
| volume_zscore_5 | 5-day Z-score of trading volume                     |
| RSI_14          | 14-day Relative Strength Index                      |
| VIX             | Implied volatility index (if available for the SPX) |

## Analysis plan (Q2)

This uses Unsupervised Machine Learning Methods for exploring

1.  Collect and preprocess S&P 500 stock data for time-period between 2014-2024, calculating each stock’s exposure to multiple risk and return factors (e.g., momentum, value, size, volatility).
2.  Construct a feature matrix where each row represents a stock and columns represent factor exposures.
3.  Apply hierarchical clustering (such as Ward’s method) to the feature matrix to group stocks with similar profiles.
4.  Visualize the dendrogram and analyze the resulting clusters to interpret the taxonomy and identify meaningful stock groupings.

| Step | Description |
|-------------------|-----------------------------------------------------|
| Data Prep | Collect and preprocess S&P 500 stock data for 2024, computing multi-factor exposures. |
| Matrix Build | Create a matrix with stocks as rows and factor exposures as columns. |
| Clustering | Perform hierarchical clustering (e.g., Ward’s method) on the feature matrix. |
| Interpretation | Visualize and interpret the dendrogram to analyze and describe stock group taxonomy. |

Potential Variables for Use

| Variable | Description |
|-----------------------|-------------------------------------------------|
| avg_return_2024 | Average daily return in 2024 |
| volatility_2024 | Standard deviation of daily returns in 2024 |
| momentum_3m | 3-month price momentum (percent change) |
| value_ratio | Price-to-earnings (P/E) or price-to-book (P/B) ratio |
| size | Market capitalization |
| beta_market | Beta (sensitivity to S&P 500 index) |
| dividend_yield | Dividend yield |
| sector | Categorical variable for sector (for interpretation/grouping) |
| skewness_2024 | Skewness of daily returns in 2024 |
| kurtosis_2024 | Kurtosis of daily returns in 2024 |